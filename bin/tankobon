#!/usr/bin/env ruby

require "rubygems"
require "tankobon"
require "trollop"

opts = Trollop::options do
  version "tankobon #{Tankobon::VERSION} (c) 2010 Stefano Pigozzi"
  banner <<-EOS
This program lets you batch rename, resize and change colorspace for manga scans
in order to make them optimal on the Kindle DX.

Usage:
    tankobon [options] [<filename>]
where [options] are:
EOS

  opt :batch,   "Uses batch mode: moves all files to " <<
                "#{File.join(Tankobon::WORK_PATH, '<s>')}", :type => :string
  opt :open,    "Opens the WORK_PATH directory"
  opt :recipe,  "Uses recipe file", :type => :string
end

if opts[:open_given] then
  puts Tankobon::Application.methods.sort.join("\n")
  %x[open #{Tankobon::WORK_PATH}]
  exit(1)
elsif opts[:recipe_given] then
  eval(File.new(File.expand_path(opts[:recipe])).read, binding, __FILE__, __LINE__)
  exit(1)
end

app = Tankobon::Application.new(Dir.pwd)
app.use_opts! opts
app.process_dir!